<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>The source code</title>
  <link href="../resources/prettify/prettify.css" type="text/css" rel="stylesheet" />
  <script type="text/javascript" src="../resources/prettify/prettify.js"></script>
  <style type="text/css">
    .highlight { display: block; background-color: #ddd; }
  </style>
  <script type="text/javascript">
    function highlight() {
      document.getElementById(location.hash.replace(/#/, "")).className = "highlight";
    }
  </script>
</head>
<body onload="prettyPrint(); highlight();">
  <pre class="prettyprint lang-js">describe(&quot;Ext.CompositeElementLite&quot;, function(){
    
    var mainRoot, ce, makeCE,
        fooTotal = 6,
        barTotal = 5,
        bazTotal = 4,
        child1Total = 5,
        child2Total = 4,
        child1RootedTotal = 2,
        child2RootedTotal = 2,
        child1MainTotal = 3,
        child2MainTotal = 2,
        byId = function(id) {
            return document.getElementById(id);    
        };
    
    beforeEach(function(){
        mainRoot = Ext.getBody().createChild({
            id: 'mainRoot'
        });
        
        mainRoot.dom.innerHTML = [
            '&lt;div class=&quot;foo toFilter&quot; id=&quot;a&quot;&gt;',
                '&lt;div class=&quot;child1&quot;&gt;c1&lt;/div&gt;',
                '&lt;div class=&quot;child2&quot;&gt;c2&lt;/div&gt;',
                '&lt;div class=&quot;child1&quot;&gt;c3&lt;/div&gt;',
                '&lt;div class=&quot;child2&quot;&gt;c4&lt;/div&gt;',
            '&lt;/div&gt;',
            '&lt;div class=&quot;bar&quot; id=&quot;b&quot;&gt;&lt;/div&gt;',
            '&lt;div class=&quot;baz&quot; id=&quot;c&quot;&gt;&lt;/div&gt;',
            '&lt;div class=&quot;foo&quot; id=&quot;d&quot;&gt;&lt;/div&gt;',
            '&lt;div class=&quot;bar&quot; id=&quot;e&quot;&gt;&lt;/div&gt;',
            '&lt;div class=&quot;baz&quot; id=&quot;f&quot;&gt;&lt;/div&gt;',
            '&lt;div class=&quot;foo toFilter&quot; id=&quot;g&quot;&gt;&lt;/div&gt;',
            '&lt;div class=&quot;bar&quot; id=&quot;h&quot;&gt;&lt;/div&gt;',
            '&lt;div class=&quot;baz&quot; id=&quot;i&quot;&gt;&lt;/div&gt;',
            '&lt;div class=&quot;foo&quot; id=&quot;j&quot;&gt;&lt;/div&gt;',
            '&lt;div class=&quot;bar&quot; id=&quot;k&quot;&gt;&lt;/div&gt;',
            '&lt;div class=&quot;baz&quot; id=&quot;l&quot;&gt;&lt;/div&gt;',
            '&lt;div class=&quot;foo&quot; id=&quot;m&quot;&gt;&lt;/div&gt;',
            '&lt;div class=&quot;bar&quot; id=&quot;n&quot;&gt;&lt;/div&gt;',
            '&lt;div class=&quot;foo&quot; id=&quot;o&quot;&gt;&lt;/div&gt;',
            '&lt;div class=&quot;child1&quot; id=&quot;p&quot;&gt;&lt;/div&gt;',
            '&lt;div class=&quot;child2&quot; id=&quot;q&quot;&gt;&lt;/div&gt;',
            '&lt;div class=&quot;child1&quot; id=&quot;r&quot;&gt;&lt;/div&gt;',
            '&lt;div class=&quot;child2&quot; id=&quot;s&quot;&gt;&lt;/div&gt;',
            '&lt;div class=&quot;child1&quot; id=&quot;t&quot;&gt;&lt;/div&gt;'
        ];
        
        makeCE = function(els, root) {
            ce = new Ext.CompositeElementLite(els, root);
        };
    });
    
    afterEach(function(){
        mainRoot.remove();
        makeCE = mainRoot = ce = null;
    });
    
    describe(&quot;add&quot;, function(){
        it(&quot;should accept a selector&quot;, function(){
            makeCE();
            ce.add('.foo');
            expect(ce.getCount()).toBe(fooTotal);
        });  
        
        it(&quot;should accept a selector with a root&quot;, function(){
            makeCE();
            ce.add('.child1', 'a');
            expect(ce.getCount()).toBe(child1RootedTotal);    
        });
        
        it(&quot;should accept another CompositeElement&quot;, function(){
            var other = new Ext.CompositeElementLite();
            other.add(byId('a'));
            other.add(byId('b'));
            other.add(byId('c'));
            makeCE();
            ce.add(other);
            expect(ce.getCount()).toBe(3);
        });
        
        it(&quot;should accept an array of elements&quot;, function(){
            makeCE();
            ce.add([byId('a'), byId('b')]);
            expect(ce.getCount()).toBe(2);    
        });
        
        it(&quot;should accept a NodeList&quot;, function(){
            makeCE();
            ce.add(byId('a').getElementsByTagName('div'));
            expect(ce.getCount()).toBe(4);  
        });
        
        it(&quot;should accept a single element&quot;, function(){
            makeCE();
            ce.add(byId('a'));
            expect(ce.getCount()).toBe(1);    
        });
        
        it(&quot;should accept a null argument&quot;, function(){
            makeCE();
            expect(ce.add(null)).toBe(ce);
        });
        
        it(&quot;should return the CompositeElement&quot;, function(){
            makeCE();
            expect(ce.add('.foo')).toBe(ce);
        })
    });
    
    describe(&quot;item&quot;, function(){
        it(&quot;should return null if there are no items&quot;, function(){
            makeCE();
            expect(ce.item(0)).toBeNull();
        });
        
        it(&quot;should return null if an item at that index does not exist&quot;, function(){
            makeCE('.foo');    
            expect(ce.item(fooTotal)).toBeNull();
        });
        
        it(&quot;should return the item at the specified index&quot;, function(){
            makeCE('.foo');
            expect(ce.item(2).dom.id).toBe('g');    
        });
        
        describe(&quot;first&quot;, function(){
            it(&quot;should return null when there are no items&quot;, function(){
                makeCE();
                expect(ce.first()).toBeNull();
            });
            
            it(&quot;should return the first item&quot;, function(){
                makeCE('.foo');
                expect(ce.first().dom.id).toBe('a');    
            });
        });
        
        describe(&quot;last&quot;, function(){
            it(&quot;should return null when there are no items&quot;, function(){
                makeCE();
                expect(ce.last()).toBeNull();
            });
            
            it(&quot;should return the last item&quot;, function(){
                makeCE('.foo');
                expect(ce.last().dom.id).toBe('o');
            })
        });
    });
    
    describe(&quot;each&quot;, function(){
        it(&quot;should never iterate if there are no items&quot;, function(){
            var cnt = 0;
            makeCE();
            ce.each(function(){
                ++cnt;
            });    
            expect(cnt).toBe(0);
        });  
        
        it(&quot;should iterate over each item&quot;, function(){
            var cnt = 0;
            makeCE('.baz');
            ce.each(function(){
                ++cnt;
            });
            expect(cnt).toBe(bazTotal);
        });
        
        it(&quot;should default the scope to the element&quot;, function(){
            var isEl;
            makeCE(byId('a'));
            ce.each(function(e){
                isEl = (e == this);
            });
            expect(isEl).toBe(true);
        });
        
        it(&quot;should use a specified scope&quot;, function(){
            var o = {},
                scope;
                
            makeCE('.foo');  
            ce.each(function(){
                scope = this;
            }, o);  
            expect(scope).toBe(o);
        });
        
        it(&quot;should pass the element, the ce &amp; the index&quot;, function(){
            var info;
            makeCE(byId('a'));
            ce.each(function(el, theCE, index){
                info = [el.dom.id, theCE, index];
            });    
            expect(info).toEqual(['a', ce, 0]);
        });
        
        it(&quot;should exit upon returning false&quot;, function(){
            var cnt = 0;
            makeCE('.foo');
            ce.each(function(el){
                if (el.dom.id == 'd') {
                    return false;
                }
                ++cnt;
            });
            expect(cnt).toBe(1);
        });
        
        it(&quot;should return the CompositeElement&quot;, function(){
            makeCE();
            expect(ce.each(function(){})).toBe(ce);    
        });
    });
    
    describe(&quot;fill&quot;, function(){
        it(&quot;should clear any existing elements&quot;, function(){
            makeCE('.foo');
            ce.fill(null);
            expect(ce.getCount()).toBe(0);    
        });
        
        it(&quot;should accept a selector&quot;, function(){
            makeCE('.foo');
            expect(ce.getCount()).toBe(fooTotal);
            ce.fill('.bar');
            expect(ce.getCount()).toBe(barTotal);    
        });
        
        it(&quot;should accept an array of elements&quot;, function(){
            makeCE();
            ce.fill([byId('a'), byId('b')]);
            expect(ce.getCount()).toBe(2);    
        });
        
        it(&quot;should accept a NodeList&quot;, function(){
            makeCE();
            ce.fill(byId('a').getElementsByTagName('div'));
            expect(ce.getCount()).toBe(4);  
        });
        
        it(&quot;should accept another CompositeElement&quot;, function(){
            var other = new Ext.CompositeElementLite();
            other.add(byId('a'));
            other.add(byId('b'));
            other.add(byId('c'));
            makeCE();
            ce.fill(other);
            expect(ce.getCount()).toBe(3);
        });
        
        it(&quot;should return the CompositeElement&quot;, function(){
            makeCE();
            expect(ce.fill(null)).toBe(ce);
        });
    });
    
    describe(&quot;filter&quot;, function(){
        
        it(&quot;should accept a selector&quot;, function(){
            makeCE('.foo');
            expect(ce.getCount(fooTotal));
            expect(ce.filter('.toFilter').getCount()).toBe(2);
        });
        
        it(&quot;should return the CompositeElement&quot;, function(){
            makeCE();
            expect(ce.filter(function(){})).toBe(ce);    
        });  
        
        it(&quot;should accept a function&quot;, function(){
            makeCE('.foo');
            ce.filter(function(el){
                var id = el.dom.id;
                return id == 'a' || id == 'd' || id == 'g';    
            });
            expect(ce.getCount()).toBe(3);
        });
        
        it(&quot;should set the scope to the element&quot;, function(){
            var id;
            makeCE(byId('a'));
            ce.filter(function(){
                id = this.dom.id;
            }); 
            expect(id).toBe('a');
        });
        
        it(&quot;should pass the element, the CompositeElement &amp; the index&quot;, function(){
            var info;
            makeCE(byId('a'));
            ce.filter(function(el, otherCE, index){
                info = [el.dom.id, otherCE, index];
            }); 
            expect(info).toEqual(['a', ce, 0]);
        });
    });
    
    describe(&quot;indexOf&quot;, function(){
        it(&quot;should return -1 when there are no items&quot;, function(){
            makeCE();
            expect(ce.indexOf('a')).toBe(-1);    
        });
        
        it(&quot;should return -1 when the item doesn't exist in the collection&quot;, function(){
            makeCE('.bar');
            expect(ce.indexOf('a')).toBe(-1);   
        });
        
        it(&quot;should accept an id&quot;, function(){
            makeCE('.foo');
            expect(ce.indexOf('a')).toBe(0);    
        });
        
        it(&quot;should accept an HTMLElement&quot;, function(){
            makeCE('.foo');
            expect(ce.indexOf(byId('d'))).toBe(1);    
        });
        
        it(&quot;should accept an Ext.dom.Element&quot;, function(){
            makeCE('.foo');
            expect(ce.indexOf(Ext.fly('g'))).toBe(2);
        });
    });
    
    describe(&quot;contains&quot;, function(){
        it(&quot;should return false when there are no items&quot;, function(){
            makeCE();
            expect(ce.contains('a')).toBe(false);    
        });
        
        it(&quot;should return false when the item doesn't exist in the collection&quot;, function(){
            makeCE('.bar');
            expect(ce.contains('a')).toBe(false);   
        });
        
        it(&quot;should accept an id&quot;, function(){
            makeCE('.foo');
            expect(ce.contains('a')).toBe(true);    
        });
        
        it(&quot;should accept an HTMLElement&quot;, function(){
            makeCE('.foo');
            expect(ce.contains(byId('d'))).toBe(true);    
        });
        
        it(&quot;should accept an Ext.dom.Element&quot;, function(){
            makeCE('.foo');
            expect(ce.contains(Ext.fly('g'))).toBe(true);
        });
    });
    
    describe(&quot;removeElement&quot;, function(){
        it(&quot;should accept a string id&quot;, function(){
            makeCE('.foo');
            ce.removeElement('a');
            expect(ce.contains('a')).toBe(false);
        });
        
        it(&quot;should accept an HTMLElement&quot;, function(){
            makeCE('.foo');
            ce.removeElement(byId('a'));
            expect(ce.contains('a')).toBe(false);
        });
        
        it(&quot;should accept an Ext.dom.Element&quot;, function(){
            makeCE('.foo');
            ce.removeElement(Ext.fly('a'));
            expect(ce.contains('a')).toBe(false);
        });
        
        it(&quot;should accept an index&quot;, function(){
            makeCE('.foo');
            ce.removeElement(0);
            expect(ce.contains('a')).toBe(false);
        });
        
        it(&quot;should remove the element if removeDom is specified&quot;, function(){
            makeCE('.foo');
            ce.removeElement('a', true);
            // refill from DOM
            ce.fill('.foo');
            expect(ce.contains('a')).toBe(false);    
        });
        
        it(&quot;should return the CompositeElement&quot;, function(){
            makeCE();
            expect(ce.removeElement(null)).toBe(ce);    
        });
    });
    
    describe(&quot;clear&quot;, function(){
        it(&quot;should do nothing when the collection is empty&quot;, function(){
            makeCE();
            ce.clear();
            expect(ce.getCount()).toBe(0);    
        });
        
        it(&quot;should remove all elements&quot;, function(){
            makeCE('.foo');
            ce.clear();
            expect(ce.getCount()).toBe(0);    
        });
    });
    
});
</pre>
</body>
</html>
